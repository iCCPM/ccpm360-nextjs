# 邮件配置备份文档

## 配置概述

本文档记录了CCPM360项目的邮件发送配置，采用一用一备策略：

- 主要方案：EmailJS（客户端发送）
- 备用方案：腾讯企业邮箱 + Nodemailer（服务器端发送）

## 环境变量配置

### EmailJS配置

```
NEXT_PUBLIC_EMAILJS_SERVICE_ID=service_xxx
NEXT_PUBLIC_EMAILJS_TEMPLATE_ID=template_xxx
NEXT_PUBLIC_EMAILJS_PUBLIC_KEY=8T9H_VHVx5vXUgWAR
```

### 腾讯企业邮箱配置

```
SMTP_HOST=smtp.exmail.qq.com
SMTP_PORT=465
SMTP_SECURE=true
SMTP_USER=your-email@company.com
SMTP_PASS=your-password
```

## 核心文件说明

### 1. src/lib/emailjs.ts

- 客户端EmailJS配置和发送逻辑
- 包含配置检查和服务可用性检测
- 仅在客户端环境使用

### 2. src/lib/server-email.ts

- 服务器端邮件发送配置
- 使用Nodemailer + 腾讯企业邮箱SMTP
- 包含邮件模板和发送函数

### 3. src/app/api/assessment/email/route.ts

- 邮件发送API路由
- 实现一用一备策略：优先使用EmailJS，失败时自动切换到腾讯企业邮箱
- 包含详细的错误处理和日志记录

## 发送策略流程

1. **优先使用EmailJS**
   - 检查EmailJS配置是否完整
   - 尝试使用EmailJS发送邮件
   - 记录发送结果

2. **备用腾讯企业邮箱**
   - 当EmailJS发送失败时自动触发
   - 使用服务器端Nodemailer发送
   - 提供更高的可靠性

3. **错误处理**
   - 详细的错误日志记录
   - 自动重试机制
   - 用户友好的错误提示

## 重要提醒

⚠️ **请勿随意修改此配置**

- 当前配置已经过充分测试，具有良好的容错能力
- 修改前请先备份现有配置
- 建议在测试环境验证后再应用到生产环境

## 测试验证

可以通过以下方式测试邮件发送功能：

1. 完成一次测评，检查邮件是否正常发送
2. 查看浏览器控制台和服务器日志
3. 验证邮件内容格式是否正确

---

_备份时间：2024年12月_
_配置版本：v1.0_
