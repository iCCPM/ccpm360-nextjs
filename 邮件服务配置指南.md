# 邮件服务配置指南

## 概述

CCPM360项目支持两种邮件发送方案：

1. **EmailJS**（推荐）- 前端邮件发送服务，配置简单
2. **腾讯企业邮箱SMTP**（备用）- 服务器端邮件发送，更稳定

## 当前状态

根据测试结果，您的邮件服务配置状态：

- ❌ EmailJS：未配置
- ❌ SMTP：未配置

**这就是为什么用户完成测评后收不到邮件的原因。**

## 快速修复步骤

### 方案一：配置EmailJS（推荐）

#### 1. 注册EmailJS账户

1. 访问 [EmailJS官网](https://www.emailjs.com/)
2. 注册免费账户
3. 创建邮件服务（推荐使用Gmail）

#### 2. 获取配置参数

1. 在EmailJS控制台中：
   - 复制 **Service ID**
   - 复制 **Template ID**（创建邮件模板后获得）
   - 复制 **Public Key**

#### 3. 配置环境变量

编辑 `.env.local` 文件，取消注释并填入真实值：

```bash
# EmailJS配置（推荐方案）
NEXT_PUBLIC_EMAILJS_SERVICE_ID=your_service_id_here
NEXT_PUBLIC_EMAILJS_TEMPLATE_ID=your_template_id_here
NEXT_PUBLIC_EMAILJS_PUBLIC_KEY=your_public_key_here
```

### 方案二：配置腾讯企业邮箱SMTP

#### 1. 开通腾讯企业邮箱

1. 访问 [腾讯企业邮箱](https://exmail.qq.com/)
2. 注册企业邮箱账户
3. 开启SMTP服务

#### 2. 配置环境变量

编辑 `.env.local` 文件，取消注释并填入真实值：

```bash
# 腾讯企业邮箱SMTP配置（备用方案）
SMTP_HOST=smtp.exmail.qq.com
SMTP_PORT=465
SMTP_SECURE=true
SMTP_USER=your_email@yourdomain.com
SMTP_PASS=your_email_password
```

## 验证配置

### 1. 运行配置检查脚本

```bash
node check-email-config.cjs
```

### 2. 测试邮件发送

```bash
node test-email-api.mjs
```

### 3. 检查开发服务器

确保开发服务器正在运行：

```bash
npm run dev
```

## 部署到Vercel

### 1. 设置环境变量

在Vercel项目设置中添加环境变量：

**EmailJS方案：**

- `NEXT_PUBLIC_EMAILJS_SERVICE_ID`
- `NEXT_PUBLIC_EMAILJS_TEMPLATE_ID`
- `NEXT_PUBLIC_EMAILJS_PUBLIC_KEY`

**SMTP方案：**

- `SMTP_HOST`
- `SMTP_PORT`
- `SMTP_SECURE`
- `SMTP_USER`
- `SMTP_PASS`

### 2. 重新部署

```bash
vercel --prod
```

## 故障排除

### 常见问题

1. **邮件发送失败**
   - 检查环境变量是否正确配置
   - 验证EmailJS或SMTP凭据
   - 查看浏览器控制台错误信息

2. **收不到邮件**
   - 检查垃圾邮件文件夹
   - 确认收件人邮箱地址正确
   - 验证邮件服务商设置

3. **API返回400错误**
   - 确保请求包含必需字段：`type`, `recipientEmail`, `data`
   - 检查数据格式是否正确

### 调试步骤

1. **检查环境变量**

   ```bash
   node check-email-config.cjs
   ```

2. **测试API端点**

   ```bash
   node test-email-api.mjs
   ```

3. **查看服务器日志**
   - 开发环境：查看终端输出
   - 生产环境：查看Vercel函数日志

## 推荐配置

为了确保邮件服务的稳定性，建议：

1. **优先使用EmailJS**：配置简单，免费额度充足
2. **配置SMTP作为备用**：提供更高的可靠性
3. **监控邮件发送状态**：定期检查邮件发送记录
4. **测试不同邮箱**：确保兼容性

## 联系支持

如果遇到配置问题，请：

1. 查看项目文档：`邮件配置备份.md`
2. 运行诊断脚本：`check-email-config.cjs`
3. 联系技术支持：contact@ccpm360.com

---

**重要提醒**：配置完成后，请务必测试邮件发送功能，确保用户能够正常收到测评报告。
