# 邮件服务配置指南

本项目支持两种邮件发送方式：EmailJS 和腾讯企业邮箱 SMTP。系统会自动检测配置并选择可用的服务。

## 方案一：EmailJS 配置（推荐）

EmailJS 是一个简单易用的邮件发送服务，无需后端服务器即可发送邮件。

### 1. 注册 EmailJS 账户

1. 访问 [EmailJS 官网](https://www.emailjs.com/)
2. 点击 "Sign Up" 注册账户
3. 验证邮箱并登录

### 2. 创建邮件服务

1. 在 EmailJS 控制台中，点击 "Email Services"
2. 点击 "Add New Service"
3. 选择您的邮件提供商（如 Gmail、Outlook 等）
4. 按照提示配置邮件服务
5. 记录生成的 **Service ID**（例如：`service_ccpm360`）

### 3. 创建邮件模板

1. 在控制台中，点击 "Email Templates"
2. 点击 "Create New Template"
3. 设置模板名称：`assessment_result`
4. 配置邮件模板：
   - **To Email**: `{{recipientEmail}}`
   - **Subject**: `{{subject}}`
   - **Content**: `{{{htmlContent}}}`
5. 保存模板并记录 **Template ID**（例如：`template_assessment_result`）

### 4. 获取 Public Key

1. 在控制台中，点击 "Account"
2. 在 "API Keys" 部分找到 **Public Key**
3. 复制该密钥

### 5. 更新项目配置

在项目根目录的 `.env` 文件中添加以下配置：

```env
# EmailJS 配置
NEXT_PUBLIC_EMAILJS_SERVICE_ID=service_ccpm360
NEXT_PUBLIC_EMAILJS_TEMPLATE_ID=template_assessment_result
NEXT_PUBLIC_EMAILJS_PUBLIC_KEY=your_emailjs_public_key
```

## 方案二：腾讯企业邮箱 SMTP 配置

如果您有腾讯企业邮箱，可以使用 SMTP 方式发送邮件。

### 1. 开启 SMTP 服务

1. 登录腾讯企业邮箱管理后台
2. 进入 "邮箱设置" > "客户端设置"
3. 开启 "SMTP" 服务
4. 记录 SMTP 服务器信息

### 2. 获取应用密码

1. 在邮箱设置中找到 "安全设置"
2. 开启 "安全登录"
3. 生成 "应用专用密码"
4. 记录生成的密码（不是邮箱登录密码）

### 3. 更新项目配置

在项目根目录的 `.env` 文件中配置：

```env
# 腾讯企业邮箱 SMTP 配置
EMAIL_HOST=smtp.exmail.qq.com
EMAIL_PORT=465
EMAIL_SECURE=true
EMAIL_USER=your-email@your-domain.com
EMAIL_PASS=your-app-password
EMAIL_FROM=your-email@your-domain.com
EMAIL_FROM_NAME=CCPM360
```

**重要说明：**

- `EMAIL_USER` 和 `EMAIL_FROM` 应该是您的企业邮箱地址
- `EMAIL_PASS` 是应用专用密码，不是邮箱登录密码
- `your-domain.com` 应该替换为您的企业域名

## 测试邮件发送

配置完成后，可以通过以下方式测试：

### 1. 使用测试脚本

```bash
node test-email.js
```

### 2. 通过评估页面

1. 启动开发服务器：`npm run dev`
2. 访问评估页面
3. 完成评估并填写邮箱地址
4. 提交评估，检查邮件是否发送成功

## 故障排除

### EmailJS 常见问题

1. **403 Forbidden**: 检查 Public Key 是否正确
2. **Template not found**: 确认 Template ID 是否正确
3. **Service not found**: 确认 Service ID 是否正确

### 腾讯企业邮箱常见问题

1. **535 Authentication failed**:
   - 检查邮箱地址和应用密码是否正确
   - 确认已开启 SMTP 服务
   - 确认使用的是应用专用密码而非登录密码

2. **连接超时**:
   - 检查网络连接
   - 确认端口 465 未被防火墙阻止

3. **SSL/TLS 错误**:
   - 确认 `EMAIL_SECURE=true`
   - 检查服务器是否支持 SSL

## 配置优先级

系统会按以下优先级选择邮件服务：

1. **EmailJS**：如果配置了完整的 EmailJS 参数
2. **腾讯企业邮箱**：如果配置了完整的 SMTP 参数
3. **错误提示**：如果两者都未配置，会返回配置指导

## 安全注意事项

1. **不要将敏感信息提交到版本控制**
   - `.env` 文件已在 `.gitignore` 中
   - 生产环境请使用环境变量

2. **定期更换密码**
   - 定期更换应用专用密码
   - 监控邮件发送日志

3. **限制发送频率**
   - 避免短时间内大量发送邮件
   - 实施适当的频率限制

## 生产环境部署

在生产环境中，建议：

1. 使用环境变量而非 `.env` 文件
2. 配置邮件发送监控和日志
3. 实施邮件发送频率限制
4. 配置邮件发送失败重试机制

---

如有问题，请检查控制台日志或联系技术支持。
