# 邮件服务配置指南

## 概述

CCPM360项目使用腾讯企业邮箱SMTP服务发送邮件，包括评估报告和联系表单等功能。

## 当前配置状态

项目已配置使用腾讯企业邮箱SMTP服务：

- ✅ SMTP：已配置并启用
- 📧 发送地址：contact@ccpm360.com
- 🏢 服务商：腾讯企业邮箱

## SMTP配置说明

### 环境变量配置

项目使用以下环境变量配置SMTP服务：

```bash
# 邮件服务配置 (腾讯企业邮箱 SMTP)
EMAIL_HOST=smtp.exmail.qq.com
EMAIL_PORT=465
EMAIL_SECURE=true
EMAIL_USER=contact@ccpm360.com
EMAIL_PASS=your_email_password
EMAIL_FROM=contact@ccpm360.com
EMAIL_FROM_NAME=CCPM360
```

### 配置参数说明

- `EMAIL_HOST`: SMTP服务器地址
- `EMAIL_PORT`: SMTP端口（465为SSL加密端口）
- `EMAIL_SECURE`: 是否使用SSL加密连接
- `EMAIL_USER`: 发送邮件的账户
- `EMAIL_PASS`: 邮箱密码或应用专用密码
- `EMAIL_FROM`: 发件人邮箱地址
- `EMAIL_FROM_NAME`: 发件人显示名称

## 邮件功能

项目支持以下邮件发送功能：

1. **评估报告邮件** - 用户完成测评后发送PDF报告
2. **联系表单邮件** - 用户提交联系表单时发送通知

### 邮件模板

- 支持HTML格式邮件
- 自动生成PDF附件
- 包含个性化内容和建议
- 支持中文编码（UTF-8）

## 验证配置

### 1. 检查环境变量

确保 `.env.local` 文件中包含所有必需的SMTP配置：

```bash
# 检查配置文件
cat .env.local | grep EMAIL
```

### 2. 测试邮件发送

运行测试脚本验证邮件功能：

```bash
# 测试SMTP连接
node test-email-api.mjs
```

### 3. 检查开发服务器

确保开发服务器正在运行：

```bash
npm run dev
```

## 部署配置

### Vercel部署

在Vercel项目设置中添加以下环境变量：

- `EMAIL_HOST`
- `EMAIL_PORT`
- `EMAIL_SECURE`
- `EMAIL_USER`
- `EMAIL_PASS`
- `EMAIL_FROM`
- `EMAIL_FROM_NAME`

### 重新部署

```bash
vercel --prod
```

## 故障排除

### 常见问题

1. **邮件发送失败**
   - 检查SMTP凭据是否正确
   - 验证网络连接
   - 查看服务器错误日志

2. **收不到邮件**
   - 检查垃圾邮件文件夹
   - 确认收件人邮箱地址正确
   - 验证SMTP服务状态

3. **中文乱码问题**
   - 确保使用UTF-8编码
   - 检查邮件头设置

### 调试步骤

1. **检查SMTP连接**

   ```bash
   # 测试SMTP服务器连接
   telnet smtp.exmail.qq.com 465
   ```

2. **查看API日志**
   - 开发环境：查看终端输出
   - 生产环境：查看Vercel函数日志

3. **验证邮件格式**
   - 检查HTML模板语法
   - 验证附件生成

## 安全注意事项

1. **密码安全**
   - 使用应用专用密码而非账户密码
   - 定期更换邮箱密码
   - 不要在代码中硬编码密码

2. **环境变量保护**
   - 确保 `.env.local` 不被提交到版本控制
   - 在生产环境中安全存储敏感信息

3. **邮件内容安全**
   - 验证用户输入
   - 防止邮件注入攻击
   - 限制邮件发送频率

## 监控和维护

### 邮件发送监控

- 定期检查邮件发送成功率
- 监控SMTP服务状态
- 记录邮件发送日志

### 定期维护

- 更新SMTP密码
- 检查邮件模板
- 优化邮件发送性能

## 联系支持

如果遇到邮件配置问题，请：

1. 查看服务器日志获取详细错误信息
2. 运行诊断脚本检查配置
3. 联系技术支持：contact@ccpm360.com

---

**重要提醒**：确保SMTP配置正确后，请务必测试邮件发送功能，验证用户能够正常收到评估报告和其他邮件通知。
