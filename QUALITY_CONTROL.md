# CCPM360 质量控制流程

## 概述

本文档定义了CCPM360项目在提交代码和部署前必须执行的质量控制流程，旨在确保代码质量、构建成功和部署稳定性。

## 提交部署前质控检查清单

### 🔍 必须执行的检查项目

#### 1. 代码质量检查

- [ ] **ESLint检查**: `npm run lint`
- [ ] **代码格式化**: `npm run format`
- [ ] **TypeScript类型检查**: `npm run type-check`

#### 2. 构建验证

- [ ] **完整构建测试**: `npm run build`
- [ ] **构建产物检查**: 确认`.next`目录生成正确
- [ ] **依赖完整性**: 验证所有import的组件和模块存在

#### 3. 测试验证

- [ ] **单元测试**: `npm run test`
- [ ] **集成测试**: `npm run test:integration` (如果存在)
- [ ] **E2E测试**: `npm run test:e2e` (如果存在)

#### 4. 安全检查

- [ ] **依赖安全扫描**: `npm audit`
- [ ] **环境变量检查**: 确认敏感信息未硬编码
- [ ] **API密钥安全**: 验证密钥未暴露在客户端代码中

#### 5. 性能检查

- [ ] **Bundle大小分析**: `npm run analyze` (如果配置)
- [ ] **图片优化**: 确认图片格式和大小合理
- [ ] **代码分割**: 验证路由级别的代码分割

#### 6. 数据库和API检查

- [ ] **数据库迁移**: 确认Supabase迁移文件正确
- [ ] **API接口测试**: 验证关键API端点可访问
- [ ] **权限配置**: 检查RLS规则和用户权限

## 🚀 快速执行命令

### 一键质控检查

```bash
# 执行完整的部署前检查
npm run pre-deploy
```

### 分步执行

```bash
# 1. 代码质量
npm run lint
npm run format
npm run type-check

# 2. 构建测试
npm run build

# 3. 测试验证
npm run test

# 4. 安全检查
npm audit
```

## ⚠️ 常见问题和解决方案

### 构建失败

- **模块未找到**: 检查import路径和组件是否存在
- **TypeScript错误**: 修复类型定义和接口问题
- **依赖冲突**: 运行`npm ci`重新安装依赖

### 测试失败

- **单元测试**: 检查测试用例和模拟数据
- **集成测试**: 验证API接口和数据库连接
- **快照测试**: 更新过期的组件快照

### 安全问题

- **依赖漏洞**: 运行`npm audit fix`修复已知漏洞
- **敏感信息**: 移除硬编码的密钥和配置
- **权限问题**: 检查Supabase RLS规则配置

## 📋 部署前最终确认

在推送代码到远程仓库前，请确认：

1. ✅ 所有质控检查项目已通过
2. ✅ 本地开发服务器运行正常
3. ✅ 关键功能手动测试通过
4. ✅ 提交信息清晰描述变更内容
5. ✅ 分支策略符合团队规范

## 🔧 自动化工具

### Git钩子

- **pre-commit**: 自动执行代码格式化和基础检查
- **pre-push**: 执行完整的质控流程

### CI/CD集成

- **GitHub Actions**: 自动化构建和测试
- **Vercel部署**: 生产环境自动部署

## 📚 相关文档

- [开发指南](./DEVELOPMENT_GUIDE.md)
- [架构文档](./docs/architecture/)
- [测试策略](./docs/testing/strategy.md)
- [部署流程](./docs/deployment/)

## 🆘 获取帮助

如果在质控流程中遇到问题：

1. 查看本文档的常见问题部分
2. 检查项目的开发指南
3. 联系团队技术负责人
4. 在项目Issues中提出问题

---

**记住**: 质量控制不是阻碍开发的障碍，而是确保项目稳定性和团队协作效率的重要保障。
